var phonebook=window.phonebook||function(){function a(a){var b;a.at(c)?b=c:0===c?(a.trigger("addContact"),b=0):b=c-1,h=a.at(b)}function b(a){$(window).width()<=525?(f=!0,$(".picked").removeClass("picked"),$(".glyphicon-menu-left").closest("button").show(),$("#contact-view").is(":visible")&&$("#contact-view").css({display:"block",left:"100%"})):(f=!1,$("#contact-list-column").is(":visible")||$("#contact-list-column").css({display:"block",left:"0%"}),$("#contact-view").is(":visible")||$("#contact-view").css({display:"block",left:"0%"}),a.get({cid:h}).trigger("notMobile"),$(".glyphicon-menu-left").closest("button").hide())}var c,d,e={},f=!0,g=!1,h="c01",i=!1,j=[{first:"Adam",last:"Johnson",phone:"111-111-1111"},{first:"Vinny",last:"DeFrancesco",phone:"111-111-1111"},{first:"Corey",last:"Tucker",phone:"111-111-1111"},{first:"Emma",last:"Lydon",phone:"111-111-1111"},{first:"Kate",last:"Lowe",phone:"111-111-1111"},{first:"Jess",last:"Guerra",phone:"111-111-1111"},{first:"Zach",last:"Oliphant",phone:"111-111-1111"},{first:"Larry",last:"Oliphant",phone:"111-111-1111"},{first:"Lee",last:"DeFrancesco",phone:"111-111-1111"},{first:"Barry",last:"Lydon",phone:"111-111-1111"},{first:"Derek",last:"Jeter",phone:"111-111-1111"},{first:"Marshawn",last:"Lynch",phone:"111-111-1111"},{first:"Barack",last:"Obama",phone:"111-111-1111"},{first:"Mitt",last:"Romney",phone:"111-111-1111"},{first:"Michelle",last:"Obama",phone:"111-111-1111"},{first:"Ann",last:"Romney",phone:"111-111-1111"},{first:"Abriella",last:"Milazzo",phone:"111-111-1111"},{first:"Ryan",last:"Smith",phone:"111-111-1111"}];return e.Contact=Backbone.Model.extend({initialize:function(){this.on("destroy",this.onDestroy,this)},onDestroy:function(){c=this.collection.indexOf(this)}}),e.SearchView=Backbone.View.extend({el:".top-bar",template:' 		<div class="col-xs-10">            <div class="search-group has-feedback">                <i class="glyphicon glyphicon-search form-control-feedback"></i>                <input type="search" class="form-control searching" placeholder="Search..."></input>            </div>        </div>        <button class="btn btn-default" type="button">            <span class="glyphicon glyphicon-plus"></span>        </button>		',events:{"click button":"addContact","keyup .searching":"searchList"},initialize:function(){this.render()},render:function(){$(this.el).html(this.template)},addContact:function(){i||(this.collection.trigger("addContact"),f&&this.collection.trigger("showViewport"))},searchList:function(){this.collection.trigger("searched")}}),e.ListView=Backbone.View.extend({id:"contact-list",$container:$("#contact-list-column"),initialize:function(){this.listenTo(this.collection,"add searched edited",this.populate),this.render()},render:function(){this.$container.append(this.$el),this.populate()},populate:function(){var a=this;this.collection.search($(".searching").val()).forEach(function(b){new e.ListingView({model:b,collection:a.collection})})}}),e.ListingView=Backbone.View.extend({className:"contact-listing row",$container:$("#contact-list"),template:_.template('             <div class="col-xs-10 listing-name"><p><%= name %></p></div>             <div class="delete-contact col-xs-2 glyphicon glyphicon-trash"></div>'),events:{"click .delete-contact":"listDelete","click .listing-name":"pickName"},initialize:function(){this.render(),this.listenTo(this.model,"destroy",this.removeView),this.listenTo(this.model,"notMobile",this.notMobile),this.listenTo(this.model,"pick",this.pickName),this.listenTo(this.collection,"add edited searched",this.removeView),this.model.cid!==h||f||this.$el.addClass("picked")},render:function(){var a=this.template({name:this.model.get("last")+", "+this.model.get("first")});this.$el.html(a),this.$container.append(this.$el)},listDelete:function(){this.model.destroy()},notMobile:function(){this.$el.addClass("picked")},pickName:function(){h=this.model.cid,f?this.collection.trigger("showViewport"):($(".picked").removeClass("picked"),this.$el.addClass("picked")),this.collection.trigger("pickName")},removeView:function(){this.remove(),this.stopListening()}}),e.ViewportInfoView=Backbone.View.extend({template:_.template('		<form>			<p>First Name:<input class="info-input" name="first" type="text" value="<%= first %>" readonly></p>			<p>Last Name:<input class="info-input" name="last" type="text" value="<%= last %>"" readonly></p>			<p>Phone Number:<input class="info-input" name="phone" type="text" value="<%= phone %>"" readonly></p>		</form>		<div id="validationContainer"> 		<p class="validationMessage">Please enter a valid first name.</p> 		<p class="validationMessage">Please enter a valid last name.</p> 		<p class="validationMessage">Please enter a valid 10-digit phone number.</p> 		</div> 	'),events:{},initialize:function(){this.render(),this.listenTo(this.collection,"pickName",this.changeModel,this),this.listenTo(this.collection,"addContact",this.newModel,this),this.listenTo(this.collection,"edit",this.edit,this)},render:function(){var a=this.template({first:this.model.get("first"),last:this.model.get("last"),phone:this.model.get("phone")});this.$el.html(a),this.$el.find('input[name="phone"]').mask("(000) 000-0000")},changeModel:function(){this.model=this.collection.get({cid:h}),this.render()},edit:function(){function a(){i=!0,d.attr("readonly",!1).addClass("active-edit"),c.addClass("glyphicon-floppy-save")}function b(a){var b=a[2].split(/[-()\s]/gi).join(""),c=/^[a-zA-Z]+$/.test(a[0]),d=/^[a-zA-Z]+$/.test(a[1]),e=/^\d{10}$/.test(b),f=[c,d,e],g=c&&d&&e;if(g)return!0;var h=0;f.forEach(function(a){a||($($(".info-input")[h]).css("border","1px solid red"),$($(".validationMessage")[h]).show(),console.log($(".validationMessage")[h])),h++})}var c=$(".button-edit").find("span"),d=$(".info-input"),e=[];if(i){if(d.each(function(){e.push($(this).val())}),!b(e))return!1;this.model.set({first:e[0],last:e[1],phone:e[2]}),$(".phone").text(function(a,b){return b.replace(/(\d{3})(\d{3})(\d{4})/,"$1-$2-$3")}),c.removeClass("glyphicon-floppy-save"),g&&(console.log("create contact"),this.collection.add(this.model),g=!1),this.render(),h=this.model.cid,this.collection.trigger("edited"),i=!1}else a()},newModel:function(){this.model=h,this.render(),this.edit()}}),e.ValidationView=Backbone.View.extend({}),e.ViewportView=Backbone.View.extend({model:e.Contact,className:"contact-info row",$container:$("#contact-view"),template:_.template('             <div class="col-sm-12">                 <div class="contact-view-button-wrapper">	                <button class="btn btn-default button-back" type="button">	                        <span class="glyphicon glyphicon-menu-left"></span>		            </button>                    <button class="btn btn-default button-edit" type="button">                        <span class="glyphicon glyphicon-pencil"></span>                    </button>                    <button class="btn btn-default button-delete" type="button">                        <span class="glyphicon glyphicon-trash"></span>                    </button>                </div>                <h3><%= first %> <%= last %></h3>                <div class="contact-fields">                </div>            </div>	'),events:{"click .button-edit":"edit","click .button-delete":"delete","click .button-back":"showList"},initialize:function(){var a=this;this.listenTo(this.collection,"pickName",this.changeModel),this.listenTo(this.collection,"addContact",this.newModel),this.listenTo(this.collection,"add change",this.subRender),this.render(),new e.ViewportInfoView({model:a.model,collection:a.collection,el:".contact-fields"})},render:function(){var a=this.template({first:this.model.get("first"),last:this.model.get("last")});this.$el.html(a),this.$container.append(this.$el)},changeModel:function(){this.model=this.collection.get({cid:h}),this.subRender()},"delete":function(){i||this.model.destroy()},edit:function(){this.collection.trigger("edit")},newModel:function(){this.model=h,g=!0,this.subRender()},subRender:function(){var a=this.model.get("first")?this.model.get("first")+" "+this.model.get("last"):"New Contact";this.$el.find("h3").html(a)},showList:function(){this.collection.trigger("showList")}}),e.List=Backbone.Collection.extend({model:e.Contact,localStorage:new Backbone.LocalStorage("phonebook-store"),comparator:function(a){var b=a.get("last")+a.get("first");return b.toLowerCase()},initialize:function(){var a=this;this.on("showList",this.showList,this),this.on("showViewport",this.showViewport,this),this.on("pickName",this.changeViewport,this),this.on("addContact",this.addContact,this),this.on("remove",this.findIndex,this),this.on("edited",this.sort,this),this.on("edited searched",this.pickContact,this),this.on("change add edited",this.saveIt),this.on("edited",this.saveIt),localStorage.length?this.fetch():(this.reset(j),this.forEach(function(a){a.save()})),h=this.at(0).cid,new e.SearchView({collection:a}),new e.ListView({collection:a}),d=new e.ViewportView({collection:a,model:this.at(0)})},addContact:function(){i||(h=new e.Contact({}),$(".contact-listing").removeClass("picked"))},changeViewport:function(){d.trigger("changeViewportModel")},findIndex:function(){a(this),this.length&&this.pickContact()},pickContact:function(){},saveIt:function(){this.forEach(function(a){a.save()})},search:function(a){if(""===a)return this;var b=new RegExp(a,"i");return this.filter(function(a){return b.test(a.get("last")+" "+a.get("first"))})},showViewport:function(){$("#contact-list-column").animate({left:"-100%"},500,function(){$(this).hide()}),$("#contact-view").show(),$("#contact-view").animate({left:"0"},500)},showList:function(){$("#contact-view").animate({left:"100%"},500,function(){$(this).hide()}),$("#contact-list-column").show(),$("#contact-list-column").animate({left:"0"},500),$(".top-bar").css("width","100%")}}),$(document).ready(function(){function a(){$(".top-bar").innerWidth($(".top-bar").parent().innerWidth())}var c=new e.List;a(),b(c),$(window).resize(function(){b(c),a()})}),e}();